package require tcltest
namespace import ::tcltest::*

::tcltest::configure {*}$argv

::tcltest::loadTestedCommands

package require automata::btm

set mc BTM
set m [subst {::automata::$mc create M}]
{*}$m
M doc [file join ~ code automata-as-tools.wiki class.$mc.md]
M destroy

test btm-1.0 {3 state, 2 symbol busy beaver} -setup {} -body {
    ::automata::BTM create M
    M compile {
        {<A 0/P;R B}
        {A 1/P;L C}
        {B 0/P;L A}
        {B 1/P;R B}
        {C 0/P;L B}
        {C 1/P;R H>}
    }
    M add A 0 1
    M run {0}
} -cleanup {
    M destroy
    log::lvSuppressLE i 1
} -result {{{1 1 1 1 1 1 0} 1 H}}

test btm-1.1 {3 state, 2 symbol busy beaver print} -setup {} -body {
    ::automata::BTM create M
    M compile {
        {<A 0/P;R B}
        {A 1/P;L C}
        {B 0/P;L A}
        {B 1/P;R B}
        {C 0/P;L B}
        {C 1/P;R H>}
    }
    M print
} -cleanup {
    M destroy
    log::lvSuppressLE i 1
} -output {Tape symbols    A = {0, 1}
Print symbols   B = {E, P, N}
Move symbols    C = {L, R, N}
State symbols   Q = {A, B, C, H}
Start symbol    S = A
Final symbols   F = {H}
Head position   H = 0
Transitions
q0    inp   q1    out
A     0     B     P R
A     1     C     P L
B     0     A     P L
B     1     B     P R
C     0     B     P L
C     1     H     P R
}

test btm-1.3 {4 state, 2 symbol busy beaver} -setup {} -body {
    ::automata::BTM create M
    M add table A 0 B P R
    M add table A 1 B P L
    M add table B 0 A P L
    M add table B 1 C E L
    M add table C 0 H P R
    M add table C 1 D P L
    M add table D 0 D P R
    M add table D 1 A E R
    M add S A
    M add F H
    M run {0}
} -cleanup {
    M destroy
    log::lvSuppressLE i 1
} -result {{{1 1 1 1 1 1 1 1 1 1 1 1 0 1 0} 12 H}}

cleanupTests ; return ; # ---------------------------------
